<!DOCTYPE html>
<html>
<head>
<title>Mining Game - Double Click to Make Gold Block</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
body { margin: 0; overflow: hidden; }
canvas { background: skyblue; display: block; }
#hud {
  position: absolute;
  top: 10px;
  left: 10px;
  font-family: sans-serif;
  font-size: 20px;
  background: rgba(0,0,0,0.4);
  color: gold;
  padding: 6px 12px;
  border-radius: 8px;
  z-index: 100;
  pointer-events: none;
}
#backButton {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  color: white;
  background: #333;
  padding: 10px 20px;
  text-decoration: none;
  border-radius: 8px;
  font-family: sans-serif;
  font-size: 18px;
  z-index: 200;
}
#backButton:hover { background: #555; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud" style="display:none">Gold: 0 ðŸ’°</div>
<a id="backButton" href="index.html">Go Back</a>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);
resize();

const BLOCK_SIZE = 32;
const WORLD_WIDTH = 500;
const WORLD_HEIGHT = 500;

let world = [];
for(let y=0;y<WORLD_HEIGHT;y++){
    let row = [];
    for(let x=0;x<WORLD_WIDTH;x++){
        if(y===WORLD_HEIGHT-1) row.push("bedrock");
        else if(Math.random()<0.05) row.push("gold");
        else row.push("dirt");
    }
    world.push(row);
}
// Clear top rows
for(let y=0;y<5;y++) for(let x=0;x<WORLD_WIDTH;x++) world[y][x]="air";

let player = { x: 250*BLOCK_SIZE, y:4*BLOCK_SIZE, vx:0, vy:0, width:BLOCK_SIZE, height:BLOCK_SIZE, onGround:false };
let goldCount = 0;
const keys = {};
document.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);
let camera = {x:0, y:0};

let lastClick = { bx: null, by: null, time: 0 };

function getCanvasMousePos(e){
    const rect=canvas.getBoundingClientRect();
    const clientX = e.clientX ?? (e.touches && e.touches[0] && e.touches[0].clientX);
    const clientY = e.clientY ?? (e.touches && e.touches[0] && e.touches[0].clientY);
    if(clientX==null || clientY==null) return null;
    return { x: clientX - rect.left, y: clientY - rect.top };
}

canvas.addEventListener('click', e=>{
    const pos = getCanvasMousePos(e);
    if(!pos) return;
    const mx = pos.x + camera.x;
    const my = pos.y + camera.y;
    const bx = Math.floor(mx/BLOCK_SIZE);
    const by = Math.floor(my/BLOCK_SIZE);
    if(by<0 || by>=WORLD_HEIGHT || bx<0 || bx>=WORLD_WIDTH) return;

    const now = Date.now();
    // Double-click on same block within 400ms â†’ gold block
    if(lastClick.bx === bx && lastClick.by === by && now - lastClick.time < 400){
        world[by][bx] = "gold";
        lastClick.time = 0; // reset to avoid triple chaining
        return;
    }
    lastClick = { bx, by, time: now };

    if(world[by][bx]!=="bedrock"){
        if(world[by][bx]==="gold") goldCount++;
        world[by][bx] = world[by][bx]==="air" ? "dirt" : "air";
    }
});

// Ladder placement
document.addEventListener('keydown', e=>{
    const key=e.key.toLowerCase();
    if(key==='l' || key==='k'){
        const bx=Math.floor((player.x+player.width/2)/BLOCK_SIZE);
        const byBelow=Math.floor((player.y+player.height)/BLOCK_SIZE);
        const byAbove=Math.floor((player.y-1)/BLOCK_SIZE);
        if(key==='l' && world[byBelow] && world[byBelow][bx]==="air") world[byBelow][bx]="ladder";
        if(key==='k' && world[byAbove] && world[byAbove][bx]==="air") world[byAbove][bx]="ladder";
        return;
    }
    if(key==='s'){
        const bx=Math.floor((player.x+player.width/2)/BLOCK_SIZE);
        const byBelow=Math.floor((player.y+player.height)/BLOCK_SIZE);
        const py=Math.floor((player.y+player.height/2)/BLOCK_SIZE);
        const touchingLadder=world[py] && world[py][bx]==="ladder";
        if(!touchingLadder){
            if(world[byBelow] && world[byBelow][bx]!=="air" && world[byBelow][bx]!=="bedrock"){
                if(world[byBelow][bx]==="gold") goldCount++;
                world[byBelow][bx]="air";
            }
        }
    }
});

function gameLoop(){
    requestAnimationFrame(gameLoop);

    // Horizontal movement
    player.vx=0;
    if(keys['a']) player.vx=-3;
    if(keys['d']) player.vx=3;

    // Ladder check
    const px=Math.floor((player.x+player.width/2)/BLOCK_SIZE);
    const py=Math.floor((player.y+player.height/2)/BLOCK_SIZE);
    const touchingLadder = world[py] && world[py][px]==="ladder";

    if(touchingLadder && keys['w']) player.vy=-3;
    else if(touchingLadder && keys['s']) player.vy=3;
    else{
        if(!touchingLadder) player.vy+=0.5;
        else player.vy=0;
        if(keys['w'] && player.onGround) player.vy=-10;
    }
    player.onGround=false;

    // Horizontal collision
    let nextX=player.x+player.vx;
    let nextY=player.y+player.vy;
    const horizLeft=Math.floor(nextX/BLOCK_SIZE);
    const horizRight=Math.floor((nextX+player.width-1)/BLOCK_SIZE);
    const vertTop=Math.floor(player.y/BLOCK_SIZE);
    const vertBottom=Math.floor((player.y+player.height-1)/BLOCK_SIZE);
    let collidedX=false;
    for(let y=vertTop;y<=vertBottom;y++){
        for(let x=horizLeft;x<=horizRight;x++){
            const block = world[y] && world[y][x];
            if(block && block!=="air" && block!=="ladder"){
                if(player.vx>0) nextX=x*BLOCK_SIZE-player.width;
                if(player.vx<0) nextX=(x+1)*BLOCK_SIZE;
                collidedX=true;
            }
        }
    }
    if(collidedX) player.vx=0;

    // Vertical collision
    const vertLeft=Math.floor(nextX/BLOCK_SIZE);
    const vertRight=Math.floor((nextX+player.width-1)/BLOCK_SIZE);
    const horizTop=Math.floor(nextY/BLOCK_SIZE);
    const horizBottom=Math.floor((nextY+player.height-1)/BLOCK_SIZE);
    let collidedY=false;
    for(let y=horizTop;y<=horizBottom;y++){
        for(let x=vertLeft;x<=vertRight;x++){
            const block = world[y] && world[y][x];
            if(block && block!=="air" && block!=="ladder"){
                if(player.vy>0){ nextY=y*BLOCK_SIZE-player.height; player.onGround=true; }
                if(player.vy<0) nextY=(y+1)*BLOCK_SIZE;
                collidedY=true;
            }
        }
    }
    if(collidedY) player.vy=0;

    player.x=nextX;
    player.y=nextY;

    // Camera
    camera.x=player.x-canvas.width/2+player.width/2;
    camera.y=player.y-canvas.height/2+player.height/2;
    camera.x=Math.max(0,Math.min(camera.x,WORLD_WIDTH*BLOCK_SIZE-canvas.width));
    camera.y=Math.max(0,Math.min(camera.y,WORLD_HEIGHT*BLOCK_SIZE-canvas.height));

    // Draw
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const startX=Math.floor(camera.x/BLOCK_SIZE);
    const startY=Math.floor(camera.y/BLOCK_SIZE);
    const endX=startX+Math.ceil(canvas.width/BLOCK_SIZE);
    const endY=startY+Math.ceil(canvas.height/BLOCK_SIZE);
    ctx.font="28px Arial";
    ctx.textAlign="center";
    ctx.textBaseline="middle";

    for(let y=startY;y<=endY;y++){
        for(let x=startX;x<=endX;x++){
            if(world[y] && world[y][x]){
                const block=world[y][x];
                if(block==="dirt"){ ctx.fillStyle="#8B4513"; ctx.fillRect(x*BLOCK_SIZE-camera.x,y*BLOCK_SIZE-camera.y,BLOCK_SIZE,BLOCK_SIZE); }
                else if(block==="gold"){ ctx.fillStyle="gold"; ctx.fillRect(x*BLOCK_SIZE-camera.x,y*BLOCK_SIZE-camera.y,BLOCK_SIZE,BLOCK_SIZE); }
                else if(block==="bedrock"){ ctx.fillStyle="#444"; ctx.fillRect(x*BLOCK_SIZE-camera.x,y*BLOCK_SIZE-camera.y,BLOCK_SIZE,BLOCK_SIZE); }
                else if(block==="ladder"){ ctx.fillText("ðŸªœ",x*BLOCK_SIZE-camera.x+BLOCK_SIZE/2,y*BLOCK_SIZE-camera.y+BLOCK_SIZE/2); }
            }
        }
    }

    // Player
    ctx.fillStyle="yellow";
    ctx.fillRect(player.x-camera.x,player.y-camera.y,player.width,player.height);

    hud.textContent=`Gold: ${goldCount} ðŸ’°`;
}
gameLoop();
</script>
</body>
</html>
