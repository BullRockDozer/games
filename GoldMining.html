<!DOCTYPE html>
<html>
<head>
<title>Mining Game with Ladder Emoji</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
body { margin:0; overflow:hidden; background:#000; }
canvas { background: skyblue; display:block; }
#hud { position:absolute; top:10px; left:10px; font-family:sans-serif; font-size:20px; background: rgba(0,0,0,0.4); color: gold; padding: 6px 12px; border-radius: 8px; z-index:100; pointer-events:none; }
button { cursor:pointer; }
#menu { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background: rgba(20,20,20,0.9); color:white; padding:20px; border-radius:10px; text-align:center; font-family:sans-serif; display:none; z-index:999; }
#menu input { margin:5px; padding:5px; }
#menu button { margin:5px; padding:5px 10px; border-radius:6px; background:#333; color:white; }
#backButton, #saveButton, #loadButton { position:absolute; bottom:10px; color:white; background:#333; padding:10px 20px; text-decoration:none; border-radius:8px; font-family:sans-serif; font-size:18px; z-index:200; }
#backButton:hover, #saveButton:hover, #loadButton:hover { background:#555; }
#backButton { left:50%; transform:translateX(-50%); }
#saveButton { right:50%; transform:translateX(-150%); }
#loadButton { left:50%; transform:translateX(150%); }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud" style="display:none">Gold: 0 ðŸ’°</div>
<a id="backButton" href="index.html">Go Back</a>
<button id="saveButton">Save</button>
<button id="loadButton">Load</button>
<div id="menu"></div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const hud = document.getElementById('hud');
const menu = document.getElementById('menu');
const saveBtn = document.getElementById('saveButton');
const loadBtn = document.getElementById('loadButton');

function resize(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener('resize',resize); resize();

const BLOCK_SIZE = 32;
const WORLD_WIDTH = 200;
const WORLD_HEIGHT = 200;

let world = [];
let goldCount = 0;
let player = { x:100*BLOCK_SIZE, y:4*BLOCK_SIZE, vx:0, vy:0, width:BLOCK_SIZE, height:BLOCK_SIZE, onGround:false };
let camera = {x:0, y:0};
let keys = {};
let gameLoaded = false;
let currentSaveName = null;

document.addEventListener('keydown', e=> keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=> keys[e.key.toLowerCase()]=false);

function makeWorld(){
  let w=[];
  for(let y=0;y<WORLD_HEIGHT;y++){
    let row=[];
    for(let x=0;x<WORLD_WIDTH;x++){
      if(y===WORLD_HEIGHT-1) row.push("bedrock");
      else if(Math.random()<0.05) row.push("gold");
      else row.push("dirt");
    }
    w.push(row);
  }
  for(let y=0;y<5;y++) for(let x=0;x<WORLD_WIDTH;x++) w[y][x]="air";
  return w;
}

function newGame(){
  world = makeWorld();
  goldCount = 0;
  player = { x:100*BLOCK_SIZE, y:4*BLOCK_SIZE, vx:0, vy:0, width:BLOCK_SIZE, height:BLOCK_SIZE, onGround:false };
  gameLoaded = false;
  currentSaveName = null;
}

function saveGame(name){
  const data = { world: world, player: player, goldCount: goldCount };
  localStorage.setItem("save_"+name, JSON.stringify(data));
}

function loadGame(name){
  const data = JSON.parse(localStorage.getItem("save_"+name));
  if(!data) return false;
  world = data.world;
  player = data.player;
  goldCount = data.goldCount;
  gameLoaded = true;
  currentSaveName = name;
  return true;
}

function deleteGame(name){
  localStorage.removeItem("save_"+name);
  showLoadMenu();
}

function showSaveMenu(){
  menu.innerHTML = `<h2>Save Game</h2>
    <input id="savename" placeholder="Save name" />
    <button onclick="confirmSave()">Save</button>
    <button onclick="closeMenu()">Cancel</button>`;
  menu.style.display='block';
}

function confirmSave(){
  const name=document.getElementById('savename').value.trim();
  if(!name) return;
  saveGame(name);
  closeMenu();
}

function showLoadMenu(){
  let saves = Object.keys(localStorage).filter(k=>k.startsWith("save_"));
  let html=`<h2>Load / Delete Save</h2>`;
  if(saves.length===0) html+=`<p>No saves found.</p>`;
  for(let s of saves){
    const n = s.replace("save_","");
    html+=`<div>
      <button onclick="loadSelected('${n}')">Load ${n}</button>
      <button onclick="deleteGame('${n}')">Delete</button>
    </div>`;
  }
  html+=`<button onclick="closeMenu()">Cancel</button>`;
  menu.innerHTML = html;
  menu.style.display='block';
}

function loadSelected(n){ loadGame(n); closeMenu(); }
function closeMenu(){ menu.style.display='none'; }

function getBlock(x,y){ return world[y] && world[y][x]; }
function setBlock(x,y,v){ if(world[y]) world[y][x]=v; }

let lastClick={bx:null,by:null,time:0};
canvas.addEventListener('click', e=>{
  const mx = e.clientX+camera.x;
  const my = e.clientY+camera.y;
  const bx = Math.floor(mx/BLOCK_SIZE);
  const by = Math.floor(my/BLOCK_SIZE);
  if(by<0||by>=WORLD_HEIGHT||bx<0||bx>=WORLD_WIDTH) return;
  if(gameLoaded) return;
  const now = Date.now();
  if(lastClick.bx===bx && lastClick.by===by && now-lastClick.time<400){
    world[by][bx]="gold";
    lastClick.time=0;
    return;
  }
  lastClick={bx,by,time:now};
  const b = world[by][bx];
  if(b && b!=="bedrock"){
    if(b==="gold") goldCount++;
    world[by][bx] = b==="air"?"dirt":"air";
  }
});

document.addEventListener('keydown', e=>{
  const k = e.key.toLowerCase();
  const bx = Math.floor((player.x + player.width/2)/BLOCK_SIZE);
  const byBelow = Math.floor((player.y + player.height)/BLOCK_SIZE);
  const byAbove = Math.floor((player.y - 1)/BLOCK_SIZE);

  if(!gameLoaded){
    if(k==='l'){ 
      if(getBlock(bx,byBelow)==="air") setBlock(bx,byBelow,"ladder");
    }
    if(k==='k'){ 
      if(getBlock(bx,byAbove)==="air") setBlock(bx,byAbove,"ladder");
    }
  }

  if(k==='s'){
    const below = getBlock(bx,byBelow);
    if(below && below!=="air" && below!=="bedrock" && below!=="ladder"){
      if(below==="gold") goldCount++;
      setBlock(bx,byBelow,"air");
    }
  }
});

function loop(){
  requestAnimationFrame(loop);

  player.vx=0;
  if(keys['a']) player.vx=-3;
  if(keys['d']) player.vx=3;

  const px = Math.floor((player.x+player.width/2)/BLOCK_SIZE);
  const py = Math.floor((player.y+player.height/2)/BLOCK_SIZE);
  const touchingLadder = getBlock(px,py)==="ladder";

  if(touchingLadder && keys['w']) player.vy=-3;
  else if(touchingLadder && keys['s']) player.vy=3;
  else{
    if(!touchingLadder) player.vy+=0.5;
    else player.vy=0;
    if(keys['w'] && player.onGround) player.vy=-10;
  }

  player.onGround=false;
  let nextX = player.x + player.vx;
  let nextY = player.y + player.vy;

  const horizLeft = Math.floor(nextX/BLOCK_SIZE);
  const horizRight = Math.floor((nextX+player.width-1)/BLOCK_SIZE);
  const vertTop = Math.floor(player.y/BLOCK_SIZE);
  const vertBottom = Math.floor((player.y+player.height-1)/BLOCK_SIZE);

  for(let y=vertTop;y<=vertBottom;y++){
    for(let x=horizLeft;x<=horizRight;x++){
      const b = getBlock(x,y);
      if(b && b!=="air" && b!=="ladder"){
        if(player.vx>0) nextX = x*BLOCK_SIZE - player.width;
        if(player.vx<0) nextX = (x+1)*BLOCK_SIZE;
        player.vx = 0;
      }
    }
  }

  const vertLeft = Math.floor(nextX/BLOCK_SIZE);
  const vertRight = Math.floor((nextX+player.width-1)/BLOCK_SIZE);
  const horizTopY = Math.floor(nextY/BLOCK_SIZE);
  const horizBottomY = Math.floor((nextY+player.height-1)/BLOCK_SIZE);
  player.onGround=false;

  for(let y=horizTopY;y<=horizBottomY;y++){
    for(let x=vertLeft;x<=vertRight;x++){
      const b = getBlock(x,y);
      if(b && b!=="air" && b!=="ladder"){
        if(player.vy>0){ nextY = y*BLOCK_SIZE - player.height; player.vy=0; player.onGround=true; }
        if(player.vy<0){ nextY = (y+1)*BLOCK_SIZE; player.vy=0; }
      }
    }
  }

  player.x = nextX;
  player.y = nextY;

  camera.x = player.x + player.width/2 - canvas.width/2;
  camera.y = player.y + player.height/2 - canvas.height/2;
  camera.x = Math.max(0, Math.min(camera.x, WORLD_WIDTH*BLOCK_SIZE - canvas.width));
  camera.y = Math.max(0, Math.min(camera.y, WORLD_HEIGHT*BLOCK_SIZE - canvas.height));

  ctx.clearRect(0,0,canvas.width,canvas.height);
  const startX = Math.floor(camera.x/BLOCK_SIZE);
  const startY = Math.floor(camera.y/BLOCK_SIZE);
  const endX = startX + Math.ceil(canvas.width/BLOCK_SIZE);
  const endY = startY + Math.ceil(canvas.height/BLOCK_SIZE);

  for(let y=startY;y<=endY;y++){
    for(let x=startX;x<=endX;x++){
      const b = getBlock(x,y);
      if(!b) continue;
      if(b==="dirt"){ ctx.fillStyle="#8B4513"; ctx.fillRect(x*BLOCK_SIZE-camera.x,y*BLOCK_SIZE-camera.y,BLOCK_SIZE,BLOCK_SIZE); }
      else if(b==="gold"){ ctx.fillStyle="gold"; ctx.fillRect(x*BLOCK_SIZE-camera.x,y*BLOCK_SIZE-camera.y,BLOCK_SIZE,BLOCK_SIZE); }
      else if(b==="bedrock"){ ctx.fillStyle="#444"; ctx.fillRect(x*BLOCK_SIZE-camera.x,y*BLOCK_SIZE-camera.y,BLOCK_SIZE,BLOCK_SIZE); }
      else if(b==="ladder"){ 
        ctx.font = `${BLOCK_SIZE-4}px Arial`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("ðŸªœ", x*BLOCK_SIZE-camera.x+BLOCK_SIZE/2, y*BLOCK_SIZE-camera.y+BLOCK_SIZE/2);
      }
    }
  }

  ctx.fillStyle="yellow";
  ctx.fillRect(player.x-camera.x,player.y-camera.y,player.width,player.height);

  hud.style.display="block";
  hud.textContent=`Gold: ${goldCount} ðŸ’°`;
}

newGame();
loop();

saveBtn.onclick = showSaveMenu;
loadBtn.onclick = showLoadMenu;
</script>
</body>
</html>
